#include <gtest/gtest.h>
#include <dcc/dcc.hpp>

TEST(scale_speed, estop) {
  EXPECT_EQ(dcc::scale_speed<14>(dcc::EStop), dcc::EStop);
  EXPECT_EQ(dcc::scale_speed<28>(dcc::EStop), dcc::EStop);
  EXPECT_EQ(dcc::scale_speed<126>(dcc::EStop), dcc::EStop);
}

TEST(scale_speed, stop) {
  EXPECT_EQ(dcc::scale_speed<14>(dcc::Stop), dcc::Stop);
  EXPECT_EQ(dcc::scale_speed<28>(dcc::Stop), dcc::Stop);
  EXPECT_EQ(dcc::scale_speed<126>(dcc::Stop), dcc::Stop);
}

TEST(scale_speed, one) {
  EXPECT_EQ(dcc::scale_speed<14>(1), dcc::scale_speed<126>(1));
  EXPECT_EQ(dcc::scale_speed<28>(1), dcc::scale_speed<126>(1));
}

TEST(scale_speed, two) {
  EXPECT_EQ(dcc::scale_speed<14>(2), 21);
  EXPECT_EQ(dcc::scale_speed<28>(2), 11);
  EXPECT_EQ(dcc::scale_speed<126>(2), 4);
}

TEST(scale_speed, three) {
  EXPECT_EQ(dcc::scale_speed<14>(3), 40);
  EXPECT_EQ(dcc::scale_speed<28>(3), 20);
  EXPECT_EQ(dcc::scale_speed<126>(3), 6);
}

TEST(scale_speed, max) {
  EXPECT_EQ(dcc::scale_speed<14>(14), 255);
  EXPECT_EQ(dcc::scale_speed<28>(28), 255);
  EXPECT_EQ(dcc::scale_speed<126>(126), 255);
}

TEST(decode_rggggg, decode_rggggg_14_speed_steps) {
  EXPECT_EQ(dcc::decode_rggggg(0b00'0001u, false), -1);
  EXPECT_EQ(dcc::decode_rggggg(0b00'0000u, false), 0);
  EXPECT_EQ(dcc::decode_rggggg(0b00'0010u, false), 1);
  EXPECT_EQ(dcc::decode_rggggg(0b00'0011u, false), 2);
  EXPECT_EQ(dcc::decode_rggggg(0b00'0100u, false), 3);
  EXPECT_EQ(dcc::decode_rggggg(0b00'0101u, false), 4);
  EXPECT_EQ(dcc::decode_rggggg(0b00'0110u, false), 5);
  EXPECT_EQ(dcc::decode_rggggg(0b00'0111u, false), 6);
  EXPECT_EQ(dcc::decode_rggggg(0b00'1000u, false), 7);
  EXPECT_EQ(dcc::decode_rggggg(0b00'1001u, false), 8);
  EXPECT_EQ(dcc::decode_rggggg(0b00'1010u, false), 9);
  EXPECT_EQ(dcc::decode_rggggg(0b00'1011u, false), 10);
  EXPECT_EQ(dcc::decode_rggggg(0b00'1100u, false), 11);
  EXPECT_EQ(dcc::decode_rggggg(0b00'1101u, false), 12);
  EXPECT_EQ(dcc::decode_rggggg(0b00'1110u, false), 13);
  EXPECT_EQ(dcc::decode_rggggg(0b00'1111u, false), 14);

  EXPECT_EQ(dcc::decode_rggggg(0b10'0001u, false), -1);
  EXPECT_EQ(dcc::decode_rggggg(0b10'0000u, false), 0);
  EXPECT_EQ(dcc::decode_rggggg(0b10'0010u, false), 1);
  EXPECT_EQ(dcc::decode_rggggg(0b10'0011u, false), 2);
  EXPECT_EQ(dcc::decode_rggggg(0b10'0100u, false), 3);
  EXPECT_EQ(dcc::decode_rggggg(0b10'0101u, false), 4);
  EXPECT_EQ(dcc::decode_rggggg(0b10'0110u, false), 5);
  EXPECT_EQ(dcc::decode_rggggg(0b10'0111u, false), 6);
  EXPECT_EQ(dcc::decode_rggggg(0b10'1000u, false), 7);
  EXPECT_EQ(dcc::decode_rggggg(0b10'1001u, false), 8);
  EXPECT_EQ(dcc::decode_rggggg(0b10'1010u, false), 9);
  EXPECT_EQ(dcc::decode_rggggg(0b10'1011u, false), 10);
  EXPECT_EQ(dcc::decode_rggggg(0b10'1100u, false), 11);
  EXPECT_EQ(dcc::decode_rggggg(0b10'1101u, false), 12);
  EXPECT_EQ(dcc::decode_rggggg(0b10'1110u, false), 13);
  EXPECT_EQ(dcc::decode_rggggg(0b10'1111u, false), 14);
}

TEST(encode_rggggg, encode_rggggg_14_speed_steps) {
  EXPECT_EQ(dcc::encode_rggggg(false, -1, false), 0b00'0001u);
  EXPECT_EQ(dcc::encode_rggggg(false, 0, false), 0b00'0000u);
  EXPECT_EQ(dcc::encode_rggggg(false, 1, false), 0b00'0010u);
  EXPECT_EQ(dcc::encode_rggggg(false, 2, false), 0b00'0011u);
  EXPECT_EQ(dcc::encode_rggggg(false, 3, false), 0b00'0100u);
  EXPECT_EQ(dcc::encode_rggggg(false, 4, false), 0b00'0101u);
  EXPECT_EQ(dcc::encode_rggggg(false, 5, false), 0b00'0110u);
  EXPECT_EQ(dcc::encode_rggggg(false, 6, false), 0b00'0111u);
  EXPECT_EQ(dcc::encode_rggggg(false, 7, false), 0b00'1000u);
  EXPECT_EQ(dcc::encode_rggggg(false, 8, false), 0b00'1001u);
  EXPECT_EQ(dcc::encode_rggggg(false, 9, false), 0b00'1010u);
  EXPECT_EQ(dcc::encode_rggggg(false, 10, false), 0b00'1011u);
  EXPECT_EQ(dcc::encode_rggggg(false, 11, false), 0b00'1100u);
  EXPECT_EQ(dcc::encode_rggggg(false, 12, false), 0b00'1101u);
  EXPECT_EQ(dcc::encode_rggggg(false, 13, false), 0b00'1110u);
  EXPECT_EQ(dcc::encode_rggggg(false, 14, false), 0b00'1111u);

  EXPECT_EQ(dcc::encode_rggggg(true, -1, false), 0b10'0001u);
  EXPECT_EQ(dcc::encode_rggggg(true, 0, false), 0b10'0000u);
  EXPECT_EQ(dcc::encode_rggggg(true, 1, false), 0b10'0010u);
  EXPECT_EQ(dcc::encode_rggggg(true, 2, false), 0b10'0011u);
  EXPECT_EQ(dcc::encode_rggggg(true, 3, false), 0b10'0100u);
  EXPECT_EQ(dcc::encode_rggggg(true, 4, false), 0b10'0101u);
  EXPECT_EQ(dcc::encode_rggggg(true, 5, false), 0b10'0110u);
  EXPECT_EQ(dcc::encode_rggggg(true, 6, false), 0b10'0111u);
  EXPECT_EQ(dcc::encode_rggggg(true, 7, false), 0b10'1000u);
  EXPECT_EQ(dcc::encode_rggggg(true, 8, false), 0b10'1001u);
  EXPECT_EQ(dcc::encode_rggggg(true, 9, false), 0b10'1010u);
  EXPECT_EQ(dcc::encode_rggggg(true, 10, false), 0b10'1011u);
  EXPECT_EQ(dcc::encode_rggggg(true, 11, false), 0b10'1100u);
  EXPECT_EQ(dcc::encode_rggggg(true, 12, false), 0b10'1101u);
  EXPECT_EQ(dcc::encode_rggggg(true, 13, false), 0b10'1110u);
  EXPECT_EQ(dcc::encode_rggggg(true, 14, false), 0b10'1111u);
}

TEST(decode_rggggg, decode_rggggg_28_speed_steps) {
  EXPECT_EQ(dcc::decode_rggggg(0b00'0001u), -1);
  EXPECT_EQ(dcc::decode_rggggg(0b01'0001u), -1);
  EXPECT_EQ(dcc::decode_rggggg(0b00'0000u), 0);
  EXPECT_EQ(dcc::decode_rggggg(0b01'0000u), 0);
  EXPECT_EQ(dcc::decode_rggggg(0b00'0010u), 1);
  EXPECT_EQ(dcc::decode_rggggg(0b01'0010u), 2);
  EXPECT_EQ(dcc::decode_rggggg(0b00'0011u), 3);
  EXPECT_EQ(dcc::decode_rggggg(0b01'0011u), 4);
  EXPECT_EQ(dcc::decode_rggggg(0b00'0100u), 5);
  EXPECT_EQ(dcc::decode_rggggg(0b01'0100u), 6);
  EXPECT_EQ(dcc::decode_rggggg(0b00'0101u), 7);
  EXPECT_EQ(dcc::decode_rggggg(0b01'0101u), 8);
  EXPECT_EQ(dcc::decode_rggggg(0b00'0110u), 9);
  EXPECT_EQ(dcc::decode_rggggg(0b01'0110u), 10);
  EXPECT_EQ(dcc::decode_rggggg(0b00'0111u), 11);
  EXPECT_EQ(dcc::decode_rggggg(0b01'0111u), 12);
  EXPECT_EQ(dcc::decode_rggggg(0b00'1000u), 13);
  EXPECT_EQ(dcc::decode_rggggg(0b01'1000u), 14);
  EXPECT_EQ(dcc::decode_rggggg(0b00'1001u), 15);
  EXPECT_EQ(dcc::decode_rggggg(0b01'1001u), 16);
  EXPECT_EQ(dcc::decode_rggggg(0b00'1010u), 17);
  EXPECT_EQ(dcc::decode_rggggg(0b01'1010u), 18);
  EXPECT_EQ(dcc::decode_rggggg(0b00'1011u), 19);
  EXPECT_EQ(dcc::decode_rggggg(0b01'1011u), 20);
  EXPECT_EQ(dcc::decode_rggggg(0b00'1100u), 21);
  EXPECT_EQ(dcc::decode_rggggg(0b01'1100u), 22);
  EXPECT_EQ(dcc::decode_rggggg(0b00'1101u), 23);
  EXPECT_EQ(dcc::decode_rggggg(0b01'1101u), 24);
  EXPECT_EQ(dcc::decode_rggggg(0b00'1110u), 25);
  EXPECT_EQ(dcc::decode_rggggg(0b01'1110u), 26);
  EXPECT_EQ(dcc::decode_rggggg(0b00'1111u), 27);
  EXPECT_EQ(dcc::decode_rggggg(0b01'1111u), 28);

  EXPECT_EQ(dcc::decode_rggggg(0b10'0001u), -1);
  EXPECT_EQ(dcc::decode_rggggg(0b11'0001u), -1);
  EXPECT_EQ(dcc::decode_rggggg(0b10'0000u), 0);
  EXPECT_EQ(dcc::decode_rggggg(0b11'0000u), 0);
  EXPECT_EQ(dcc::decode_rggggg(0b10'0010u), 1);
  EXPECT_EQ(dcc::decode_rggggg(0b11'0010u), 2);
  EXPECT_EQ(dcc::decode_rggggg(0b10'0011u), 3);
  EXPECT_EQ(dcc::decode_rggggg(0b11'0011u), 4);
  EXPECT_EQ(dcc::decode_rggggg(0b10'0100u), 5);
  EXPECT_EQ(dcc::decode_rggggg(0b11'0100u), 6);
  EXPECT_EQ(dcc::decode_rggggg(0b10'0101u), 7);
  EXPECT_EQ(dcc::decode_rggggg(0b11'0101u), 8);
  EXPECT_EQ(dcc::decode_rggggg(0b10'0110u), 9);
  EXPECT_EQ(dcc::decode_rggggg(0b11'0110u), 10);
  EXPECT_EQ(dcc::decode_rggggg(0b10'0111u), 11);
  EXPECT_EQ(dcc::decode_rggggg(0b11'0111u), 12);
  EXPECT_EQ(dcc::decode_rggggg(0b10'1000u), 13);
  EXPECT_EQ(dcc::decode_rggggg(0b11'1000u), 14);
  EXPECT_EQ(dcc::decode_rggggg(0b10'1001u), 15);
  EXPECT_EQ(dcc::decode_rggggg(0b11'1001u), 16);
  EXPECT_EQ(dcc::decode_rggggg(0b10'1010u), 17);
  EXPECT_EQ(dcc::decode_rggggg(0b11'1010u), 18);
  EXPECT_EQ(dcc::decode_rggggg(0b10'1011u), 19);
  EXPECT_EQ(dcc::decode_rggggg(0b11'1011u), 20);
  EXPECT_EQ(dcc::decode_rggggg(0b10'1100u), 21);
  EXPECT_EQ(dcc::decode_rggggg(0b11'1100u), 22);
  EXPECT_EQ(dcc::decode_rggggg(0b10'1101u), 23);
  EXPECT_EQ(dcc::decode_rggggg(0b11'1101u), 24);
  EXPECT_EQ(dcc::decode_rggggg(0b10'1110u), 25);
  EXPECT_EQ(dcc::decode_rggggg(0b11'1110u), 26);
  EXPECT_EQ(dcc::decode_rggggg(0b10'1111u), 27);
  EXPECT_EQ(dcc::decode_rggggg(0b11'1111u), 28);
}

TEST(encode_rggggg, encode_rggggg_28_speed_steps) {
  EXPECT_EQ(dcc::encode_rggggg(false, -1), 0b00'0001u);
  EXPECT_EQ(dcc::encode_rggggg(false, 0), 0b00'0000u);
  EXPECT_EQ(dcc::encode_rggggg(false, 1), 0b00'0010u);
  EXPECT_EQ(dcc::encode_rggggg(false, 2), 0b01'0010u);
  EXPECT_EQ(dcc::encode_rggggg(false, 3), 0b00'0011u);
  EXPECT_EQ(dcc::encode_rggggg(false, 4), 0b01'0011u);
  EXPECT_EQ(dcc::encode_rggggg(false, 5), 0b00'0100u);
  EXPECT_EQ(dcc::encode_rggggg(false, 6), 0b01'0100u);
  EXPECT_EQ(dcc::encode_rggggg(false, 7), 0b00'0101u);
  EXPECT_EQ(dcc::encode_rggggg(false, 8), 0b01'0101u);
  EXPECT_EQ(dcc::encode_rggggg(false, 9), 0b00'0110u);
  EXPECT_EQ(dcc::encode_rggggg(false, 10), 0b01'0110u);
  EXPECT_EQ(dcc::encode_rggggg(false, 11), 0b00'0111u);
  EXPECT_EQ(dcc::encode_rggggg(false, 12), 0b01'0111u);
  EXPECT_EQ(dcc::encode_rggggg(false, 13), 0b00'1000u);
  EXPECT_EQ(dcc::encode_rggggg(false, 14), 0b01'1000u);
  EXPECT_EQ(dcc::encode_rggggg(false, 15), 0b00'1001u);
  EXPECT_EQ(dcc::encode_rggggg(false, 16), 0b01'1001u);
  EXPECT_EQ(dcc::encode_rggggg(false, 17), 0b00'1010u);
  EXPECT_EQ(dcc::encode_rggggg(false, 18), 0b01'1010u);
  EXPECT_EQ(dcc::encode_rggggg(false, 19), 0b00'1011u);
  EXPECT_EQ(dcc::encode_rggggg(false, 20), 0b01'1011u);
  EXPECT_EQ(dcc::encode_rggggg(false, 21), 0b00'1100u);
  EXPECT_EQ(dcc::encode_rggggg(false, 22), 0b01'1100u);
  EXPECT_EQ(dcc::encode_rggggg(false, 23), 0b00'1101u);
  EXPECT_EQ(dcc::encode_rggggg(false, 24), 0b01'1101u);
  EXPECT_EQ(dcc::encode_rggggg(false, 25), 0b00'1110u);
  EXPECT_EQ(dcc::encode_rggggg(false, 26), 0b01'1110u);
  EXPECT_EQ(dcc::encode_rggggg(false, 27), 0b00'1111u);
  EXPECT_EQ(dcc::encode_rggggg(false, 28), 0b01'1111u);

  EXPECT_EQ(dcc::encode_rggggg(true, -1), 0b10'0001u);
  EXPECT_EQ(dcc::encode_rggggg(true, 0), 0b10'0000u);
  EXPECT_EQ(dcc::encode_rggggg(true, 1), 0b10'0010u);
  EXPECT_EQ(dcc::encode_rggggg(true, 2), 0b11'0010u);
  EXPECT_EQ(dcc::encode_rggggg(true, 3), 0b10'0011u);
  EXPECT_EQ(dcc::encode_rggggg(true, 4), 0b11'0011u);
  EXPECT_EQ(dcc::encode_rggggg(true, 5), 0b10'0100u);
  EXPECT_EQ(dcc::encode_rggggg(true, 6), 0b11'0100u);
  EXPECT_EQ(dcc::encode_rggggg(true, 7), 0b10'0101u);
  EXPECT_EQ(dcc::encode_rggggg(true, 8), 0b11'0101u);
  EXPECT_EQ(dcc::encode_rggggg(true, 9), 0b10'0110u);
  EXPECT_EQ(dcc::encode_rggggg(true, 10), 0b11'0110u);
  EXPECT_EQ(dcc::encode_rggggg(true, 11), 0b10'0111u);
  EXPECT_EQ(dcc::encode_rggggg(true, 12), 0b11'0111u);
  EXPECT_EQ(dcc::encode_rggggg(true, 13), 0b10'1000u);
  EXPECT_EQ(dcc::encode_rggggg(true, 14), 0b11'1000u);
  EXPECT_EQ(dcc::encode_rggggg(true, 15), 0b10'1001u);
  EXPECT_EQ(dcc::encode_rggggg(true, 16), 0b11'1001u);
  EXPECT_EQ(dcc::encode_rggggg(true, 17), 0b10'1010u);
  EXPECT_EQ(dcc::encode_rggggg(true, 18), 0b11'1010u);
  EXPECT_EQ(dcc::encode_rggggg(true, 19), 0b10'1011u);
  EXPECT_EQ(dcc::encode_rggggg(true, 20), 0b11'1011u);
  EXPECT_EQ(dcc::encode_rggggg(true, 21), 0b10'1100u);
  EXPECT_EQ(dcc::encode_rggggg(true, 22), 0b11'1100u);
  EXPECT_EQ(dcc::encode_rggggg(true, 23), 0b10'1101u);
  EXPECT_EQ(dcc::encode_rggggg(true, 24), 0b11'1101u);
  EXPECT_EQ(dcc::encode_rggggg(true, 25), 0b10'1110u);
  EXPECT_EQ(dcc::encode_rggggg(true, 26), 0b11'1110u);
  EXPECT_EQ(dcc::encode_rggggg(true, 27), 0b10'1111u);
  EXPECT_EQ(dcc::encode_rggggg(true, 28), 0b11'1111u);
}

TEST(decode_rggggggg, _128_speed_steps) {
  EXPECT_EQ(dcc::decode_rggggggg(0b0000'0001u), -1);
  EXPECT_EQ(dcc::decode_rggggggg(0b0000'0000u), 0);
  EXPECT_EQ(dcc::decode_rggggggg(0b0000'0010u), 1);
  EXPECT_EQ(dcc::decode_rggggggg(0b0000'0011u), 2);
  EXPECT_EQ(dcc::decode_rggggggg(0b0000'0100u), 3);
  EXPECT_EQ(dcc::decode_rggggggg(0b0000'0101u), 4);
  EXPECT_EQ(dcc::decode_rggggggg(0b0000'0110u), 5);
  EXPECT_EQ(dcc::decode_rggggggg(0b0000'0111u), 6);
  EXPECT_EQ(dcc::decode_rggggggg(0b0000'1000u), 7);
  EXPECT_EQ(dcc::decode_rggggggg(0b0000'1001u), 8);
  EXPECT_EQ(dcc::decode_rggggggg(0b0000'1010u), 9);
  EXPECT_EQ(dcc::decode_rggggggg(0b0000'1011u), 10);
  EXPECT_EQ(dcc::decode_rggggggg(0b0000'1100u), 11);
  EXPECT_EQ(dcc::decode_rggggggg(0b0000'1101u), 12);
  EXPECT_EQ(dcc::decode_rggggggg(0b0000'1110u), 13);
  EXPECT_EQ(dcc::decode_rggggggg(0b0000'1111u), 14);
  EXPECT_EQ(dcc::decode_rggggggg(0b0001'0000u), 15);
  EXPECT_EQ(dcc::decode_rggggggg(0b0001'0001u), 16);
  EXPECT_EQ(dcc::decode_rggggggg(0b0001'0010u), 17);
  EXPECT_EQ(dcc::decode_rggggggg(0b0001'0011u), 18);
  EXPECT_EQ(dcc::decode_rggggggg(0b0001'0100u), 19);
  EXPECT_EQ(dcc::decode_rggggggg(0b0001'0101u), 20);
  EXPECT_EQ(dcc::decode_rggggggg(0b0001'0110u), 21);
  EXPECT_EQ(dcc::decode_rggggggg(0b0001'0111u), 22);
  EXPECT_EQ(dcc::decode_rggggggg(0b0001'1000u), 23);
  EXPECT_EQ(dcc::decode_rggggggg(0b0001'1001u), 24);
  EXPECT_EQ(dcc::decode_rggggggg(0b0001'1010u), 25);
  EXPECT_EQ(dcc::decode_rggggggg(0b0001'1011u), 26);
  EXPECT_EQ(dcc::decode_rggggggg(0b0001'1100u), 27);
  EXPECT_EQ(dcc::decode_rggggggg(0b0001'1101u), 28);
  EXPECT_EQ(dcc::decode_rggggggg(0b0001'1110u), 29);
  EXPECT_EQ(dcc::decode_rggggggg(0b0001'1111u), 30);
  EXPECT_EQ(dcc::decode_rggggggg(0b0010'0000u), 31);
  EXPECT_EQ(dcc::decode_rggggggg(0b0010'0001u), 32);
  EXPECT_EQ(dcc::decode_rggggggg(0b0010'0010u), 33);
  EXPECT_EQ(dcc::decode_rggggggg(0b0010'0011u), 34);
  EXPECT_EQ(dcc::decode_rggggggg(0b0010'0100u), 35);
  EXPECT_EQ(dcc::decode_rggggggg(0b0010'0101u), 36);
  EXPECT_EQ(dcc::decode_rggggggg(0b0010'0110u), 37);
  EXPECT_EQ(dcc::decode_rggggggg(0b0010'0111u), 38);
  EXPECT_EQ(dcc::decode_rggggggg(0b0010'1000u), 39);
  EXPECT_EQ(dcc::decode_rggggggg(0b0010'1001u), 40);
  EXPECT_EQ(dcc::decode_rggggggg(0b0010'1010u), 41);
  EXPECT_EQ(dcc::decode_rggggggg(0b0010'1011u), 42);
  EXPECT_EQ(dcc::decode_rggggggg(0b0010'1100u), 43);
  EXPECT_EQ(dcc::decode_rggggggg(0b0010'1101u), 44);
  EXPECT_EQ(dcc::decode_rggggggg(0b0010'1110u), 45);
  EXPECT_EQ(dcc::decode_rggggggg(0b0010'1111u), 46);
  EXPECT_EQ(dcc::decode_rggggggg(0b0011'0000u), 47);
  EXPECT_EQ(dcc::decode_rggggggg(0b0011'0001u), 48);
  EXPECT_EQ(dcc::decode_rggggggg(0b0011'0010u), 49);
  EXPECT_EQ(dcc::decode_rggggggg(0b0011'0011u), 50);
  EXPECT_EQ(dcc::decode_rggggggg(0b0011'0100u), 51);
  EXPECT_EQ(dcc::decode_rggggggg(0b0011'0101u), 52);
  EXPECT_EQ(dcc::decode_rggggggg(0b0011'0110u), 53);
  EXPECT_EQ(dcc::decode_rggggggg(0b0011'0111u), 54);
  EXPECT_EQ(dcc::decode_rggggggg(0b0011'1000u), 55);
  EXPECT_EQ(dcc::decode_rggggggg(0b0011'1001u), 56);
  EXPECT_EQ(dcc::decode_rggggggg(0b0011'1010u), 57);
  EXPECT_EQ(dcc::decode_rggggggg(0b0011'1011u), 58);
  EXPECT_EQ(dcc::decode_rggggggg(0b0011'1100u), 59);
  EXPECT_EQ(dcc::decode_rggggggg(0b0011'1101u), 60);
  EXPECT_EQ(dcc::decode_rggggggg(0b0011'1110u), 61);
  EXPECT_EQ(dcc::decode_rggggggg(0b0011'1111u), 62);
  EXPECT_EQ(dcc::decode_rggggggg(0b0100'0000u), 63);
  EXPECT_EQ(dcc::decode_rggggggg(0b0100'0001u), 64);
  EXPECT_EQ(dcc::decode_rggggggg(0b0100'0010u), 65);
  EXPECT_EQ(dcc::decode_rggggggg(0b0100'0011u), 66);
  EXPECT_EQ(dcc::decode_rggggggg(0b0100'0100u), 67);
  EXPECT_EQ(dcc::decode_rggggggg(0b0100'0101u), 68);
  EXPECT_EQ(dcc::decode_rggggggg(0b0100'0110u), 69);
  EXPECT_EQ(dcc::decode_rggggggg(0b0100'0111u), 70);
  EXPECT_EQ(dcc::decode_rggggggg(0b0100'1000u), 71);
  EXPECT_EQ(dcc::decode_rggggggg(0b0100'1001u), 72);
  EXPECT_EQ(dcc::decode_rggggggg(0b0100'1010u), 73);
  EXPECT_EQ(dcc::decode_rggggggg(0b0100'1011u), 74);
  EXPECT_EQ(dcc::decode_rggggggg(0b0100'1100u), 75);
  EXPECT_EQ(dcc::decode_rggggggg(0b0100'1101u), 76);
  EXPECT_EQ(dcc::decode_rggggggg(0b0100'1110u), 77);
  EXPECT_EQ(dcc::decode_rggggggg(0b0100'1111u), 78);
  EXPECT_EQ(dcc::decode_rggggggg(0b0101'0000u), 79);
  EXPECT_EQ(dcc::decode_rggggggg(0b0101'0001u), 80);
  EXPECT_EQ(dcc::decode_rggggggg(0b0101'0010u), 81);
  EXPECT_EQ(dcc::decode_rggggggg(0b0101'0011u), 82);
  EXPECT_EQ(dcc::decode_rggggggg(0b0101'0100u), 83);
  EXPECT_EQ(dcc::decode_rggggggg(0b0101'0101u), 84);
  EXPECT_EQ(dcc::decode_rggggggg(0b0101'0110u), 85);
  EXPECT_EQ(dcc::decode_rggggggg(0b0101'0111u), 86);
  EXPECT_EQ(dcc::decode_rggggggg(0b0101'1000u), 87);
  EXPECT_EQ(dcc::decode_rggggggg(0b0101'1001u), 88);
  EXPECT_EQ(dcc::decode_rggggggg(0b0101'1010u), 89);
  EXPECT_EQ(dcc::decode_rggggggg(0b0101'1011u), 90);
  EXPECT_EQ(dcc::decode_rggggggg(0b0101'1100u), 91);
  EXPECT_EQ(dcc::decode_rggggggg(0b0101'1101u), 92);
  EXPECT_EQ(dcc::decode_rggggggg(0b0101'1110u), 93);
  EXPECT_EQ(dcc::decode_rggggggg(0b0101'1111u), 94);
  EXPECT_EQ(dcc::decode_rggggggg(0b0110'0000u), 95);
  EXPECT_EQ(dcc::decode_rggggggg(0b0110'0001u), 96);
  EXPECT_EQ(dcc::decode_rggggggg(0b0110'0010u), 97);
  EXPECT_EQ(dcc::decode_rggggggg(0b0110'0011u), 98);
  EXPECT_EQ(dcc::decode_rggggggg(0b0110'0100u), 99);
  EXPECT_EQ(dcc::decode_rggggggg(0b0110'0101u), 100);
  EXPECT_EQ(dcc::decode_rggggggg(0b0110'0110u), 101);
  EXPECT_EQ(dcc::decode_rggggggg(0b0110'0111u), 102);
  EXPECT_EQ(dcc::decode_rggggggg(0b0110'1000u), 103);
  EXPECT_EQ(dcc::decode_rggggggg(0b0110'1001u), 104);
  EXPECT_EQ(dcc::decode_rggggggg(0b0110'1010u), 105);
  EXPECT_EQ(dcc::decode_rggggggg(0b0110'1011u), 106);
  EXPECT_EQ(dcc::decode_rggggggg(0b0110'1100u), 107);
  EXPECT_EQ(dcc::decode_rggggggg(0b0110'1101u), 108);
  EXPECT_EQ(dcc::decode_rggggggg(0b0110'1110u), 109);
  EXPECT_EQ(dcc::decode_rggggggg(0b0110'1111u), 110);
  EXPECT_EQ(dcc::decode_rggggggg(0b0111'0000u), 111);
  EXPECT_EQ(dcc::decode_rggggggg(0b0111'0001u), 112);
  EXPECT_EQ(dcc::decode_rggggggg(0b0111'0010u), 113);
  EXPECT_EQ(dcc::decode_rggggggg(0b0111'0011u), 114);
  EXPECT_EQ(dcc::decode_rggggggg(0b0111'0100u), 115);
  EXPECT_EQ(dcc::decode_rggggggg(0b0111'0101u), 116);
  EXPECT_EQ(dcc::decode_rggggggg(0b0111'0110u), 117);
  EXPECT_EQ(dcc::decode_rggggggg(0b0111'0111u), 118);
  EXPECT_EQ(dcc::decode_rggggggg(0b0111'1000u), 119);
  EXPECT_EQ(dcc::decode_rggggggg(0b0111'1001u), 120);
  EXPECT_EQ(dcc::decode_rggggggg(0b0111'1010u), 121);
  EXPECT_EQ(dcc::decode_rggggggg(0b0111'1011u), 122);
  EXPECT_EQ(dcc::decode_rggggggg(0b0111'1100u), 123);
  EXPECT_EQ(dcc::decode_rggggggg(0b0111'1101u), 124);
  EXPECT_EQ(dcc::decode_rggggggg(0b0111'1110u), 125);
  EXPECT_EQ(dcc::decode_rggggggg(0b0111'1111u), 126);

  EXPECT_EQ(dcc::decode_rggggggg(0b1000'0001u), -1);
  EXPECT_EQ(dcc::decode_rggggggg(0b1000'0000u), 0);
  EXPECT_EQ(dcc::decode_rggggggg(0b1000'0010u), 1);
  EXPECT_EQ(dcc::decode_rggggggg(0b1000'0011u), 2);
  EXPECT_EQ(dcc::decode_rggggggg(0b1000'0100u), 3);
  EXPECT_EQ(dcc::decode_rggggggg(0b1000'0101u), 4);
  EXPECT_EQ(dcc::decode_rggggggg(0b1000'0110u), 5);
  EXPECT_EQ(dcc::decode_rggggggg(0b1000'0111u), 6);
  EXPECT_EQ(dcc::decode_rggggggg(0b1000'1000u), 7);
  EXPECT_EQ(dcc::decode_rggggggg(0b1000'1001u), 8);
  EXPECT_EQ(dcc::decode_rggggggg(0b1000'1010u), 9);
  EXPECT_EQ(dcc::decode_rggggggg(0b1000'1011u), 10);
  EXPECT_EQ(dcc::decode_rggggggg(0b1000'1100u), 11);
  EXPECT_EQ(dcc::decode_rggggggg(0b1000'1101u), 12);
  EXPECT_EQ(dcc::decode_rggggggg(0b1000'1110u), 13);
  EXPECT_EQ(dcc::decode_rggggggg(0b1000'1111u), 14);
  EXPECT_EQ(dcc::decode_rggggggg(0b1001'0000u), 15);
  EXPECT_EQ(dcc::decode_rggggggg(0b1001'0001u), 16);
  EXPECT_EQ(dcc::decode_rggggggg(0b1001'0010u), 17);
  EXPECT_EQ(dcc::decode_rggggggg(0b1001'0011u), 18);
  EXPECT_EQ(dcc::decode_rggggggg(0b1001'0100u), 19);
  EXPECT_EQ(dcc::decode_rggggggg(0b1001'0101u), 20);
  EXPECT_EQ(dcc::decode_rggggggg(0b1001'0110u), 21);
  EXPECT_EQ(dcc::decode_rggggggg(0b1001'0111u), 22);
  EXPECT_EQ(dcc::decode_rggggggg(0b1001'1000u), 23);
  EXPECT_EQ(dcc::decode_rggggggg(0b1001'1001u), 24);
  EXPECT_EQ(dcc::decode_rggggggg(0b1001'1010u), 25);
  EXPECT_EQ(dcc::decode_rggggggg(0b1001'1011u), 26);
  EXPECT_EQ(dcc::decode_rggggggg(0b1001'1100u), 27);
  EXPECT_EQ(dcc::decode_rggggggg(0b1001'1101u), 28);
  EXPECT_EQ(dcc::decode_rggggggg(0b1001'1110u), 29);
  EXPECT_EQ(dcc::decode_rggggggg(0b1001'1111u), 30);
  EXPECT_EQ(dcc::decode_rggggggg(0b1010'0000u), 31);
  EXPECT_EQ(dcc::decode_rggggggg(0b1010'0001u), 32);
  EXPECT_EQ(dcc::decode_rggggggg(0b1010'0010u), 33);
  EXPECT_EQ(dcc::decode_rggggggg(0b1010'0011u), 34);
  EXPECT_EQ(dcc::decode_rggggggg(0b1010'0100u), 35);
  EXPECT_EQ(dcc::decode_rggggggg(0b1010'0101u), 36);
  EXPECT_EQ(dcc::decode_rggggggg(0b1010'0110u), 37);
  EXPECT_EQ(dcc::decode_rggggggg(0b1010'0111u), 38);
  EXPECT_EQ(dcc::decode_rggggggg(0b1010'1000u), 39);
  EXPECT_EQ(dcc::decode_rggggggg(0b1010'1001u), 40);
  EXPECT_EQ(dcc::decode_rggggggg(0b1010'1010u), 41);
  EXPECT_EQ(dcc::decode_rggggggg(0b1010'1011u), 42);
  EXPECT_EQ(dcc::decode_rggggggg(0b1010'1100u), 43);
  EXPECT_EQ(dcc::decode_rggggggg(0b1010'1101u), 44);
  EXPECT_EQ(dcc::decode_rggggggg(0b1010'1110u), 45);
  EXPECT_EQ(dcc::decode_rggggggg(0b1010'1111u), 46);
  EXPECT_EQ(dcc::decode_rggggggg(0b1011'0000u), 47);
  EXPECT_EQ(dcc::decode_rggggggg(0b1011'0001u), 48);
  EXPECT_EQ(dcc::decode_rggggggg(0b1011'0010u), 49);
  EXPECT_EQ(dcc::decode_rggggggg(0b1011'0011u), 50);
  EXPECT_EQ(dcc::decode_rggggggg(0b1011'0100u), 51);
  EXPECT_EQ(dcc::decode_rggggggg(0b1011'0101u), 52);
  EXPECT_EQ(dcc::decode_rggggggg(0b1011'0110u), 53);
  EXPECT_EQ(dcc::decode_rggggggg(0b1011'0111u), 54);
  EXPECT_EQ(dcc::decode_rggggggg(0b1011'1000u), 55);
  EXPECT_EQ(dcc::decode_rggggggg(0b1011'1001u), 56);
  EXPECT_EQ(dcc::decode_rggggggg(0b1011'1010u), 57);
  EXPECT_EQ(dcc::decode_rggggggg(0b1011'1011u), 58);
  EXPECT_EQ(dcc::decode_rggggggg(0b1011'1100u), 59);
  EXPECT_EQ(dcc::decode_rggggggg(0b1011'1101u), 60);
  EXPECT_EQ(dcc::decode_rggggggg(0b1011'1110u), 61);
  EXPECT_EQ(dcc::decode_rggggggg(0b1011'1111u), 62);
  EXPECT_EQ(dcc::decode_rggggggg(0b1100'0000u), 63);
  EXPECT_EQ(dcc::decode_rggggggg(0b1100'0001u), 64);
  EXPECT_EQ(dcc::decode_rggggggg(0b1100'0010u), 65);
  EXPECT_EQ(dcc::decode_rggggggg(0b1100'0011u), 66);
  EXPECT_EQ(dcc::decode_rggggggg(0b1100'0100u), 67);
  EXPECT_EQ(dcc::decode_rggggggg(0b1100'0101u), 68);
  EXPECT_EQ(dcc::decode_rggggggg(0b1100'0110u), 69);
  EXPECT_EQ(dcc::decode_rggggggg(0b1100'0111u), 70);
  EXPECT_EQ(dcc::decode_rggggggg(0b1100'1000u), 71);
  EXPECT_EQ(dcc::decode_rggggggg(0b1100'1001u), 72);
  EXPECT_EQ(dcc::decode_rggggggg(0b1100'1010u), 73);
  EXPECT_EQ(dcc::decode_rggggggg(0b1100'1011u), 74);
  EXPECT_EQ(dcc::decode_rggggggg(0b1100'1100u), 75);
  EXPECT_EQ(dcc::decode_rggggggg(0b1100'1101u), 76);
  EXPECT_EQ(dcc::decode_rggggggg(0b1100'1110u), 77);
  EXPECT_EQ(dcc::decode_rggggggg(0b1100'1111u), 78);
  EXPECT_EQ(dcc::decode_rggggggg(0b1101'0000u), 79);
  EXPECT_EQ(dcc::decode_rggggggg(0b1101'0001u), 80);
  EXPECT_EQ(dcc::decode_rggggggg(0b1101'0010u), 81);
  EXPECT_EQ(dcc::decode_rggggggg(0b1101'0011u), 82);
  EXPECT_EQ(dcc::decode_rggggggg(0b1101'0100u), 83);
  EXPECT_EQ(dcc::decode_rggggggg(0b1101'0101u), 84);
  EXPECT_EQ(dcc::decode_rggggggg(0b1101'0110u), 85);
  EXPECT_EQ(dcc::decode_rggggggg(0b1101'0111u), 86);
  EXPECT_EQ(dcc::decode_rggggggg(0b1101'1000u), 87);
  EXPECT_EQ(dcc::decode_rggggggg(0b1101'1001u), 88);
  EXPECT_EQ(dcc::decode_rggggggg(0b1101'1010u), 89);
  EXPECT_EQ(dcc::decode_rggggggg(0b1101'1011u), 90);
  EXPECT_EQ(dcc::decode_rggggggg(0b1101'1100u), 91);
  EXPECT_EQ(dcc::decode_rggggggg(0b1101'1101u), 92);
  EXPECT_EQ(dcc::decode_rggggggg(0b1101'1110u), 93);
  EXPECT_EQ(dcc::decode_rggggggg(0b1101'1111u), 94);
  EXPECT_EQ(dcc::decode_rggggggg(0b1110'0000u), 95);
  EXPECT_EQ(dcc::decode_rggggggg(0b1110'0001u), 96);
  EXPECT_EQ(dcc::decode_rggggggg(0b1110'0010u), 97);
  EXPECT_EQ(dcc::decode_rggggggg(0b1110'0011u), 98);
  EXPECT_EQ(dcc::decode_rggggggg(0b1110'0100u), 99);
  EXPECT_EQ(dcc::decode_rggggggg(0b1110'0101u), 100);
  EXPECT_EQ(dcc::decode_rggggggg(0b1110'0110u), 101);
  EXPECT_EQ(dcc::decode_rggggggg(0b1110'0111u), 102);
  EXPECT_EQ(dcc::decode_rggggggg(0b1110'1000u), 103);
  EXPECT_EQ(dcc::decode_rggggggg(0b1110'1001u), 104);
  EXPECT_EQ(dcc::decode_rggggggg(0b1110'1010u), 105);
  EXPECT_EQ(dcc::decode_rggggggg(0b1110'1011u), 106);
  EXPECT_EQ(dcc::decode_rggggggg(0b1110'1100u), 107);
  EXPECT_EQ(dcc::decode_rggggggg(0b1110'1101u), 108);
  EXPECT_EQ(dcc::decode_rggggggg(0b1110'1110u), 109);
  EXPECT_EQ(dcc::decode_rggggggg(0b1110'1111u), 110);
  EXPECT_EQ(dcc::decode_rggggggg(0b1111'0000u), 111);
  EXPECT_EQ(dcc::decode_rggggggg(0b1111'0001u), 112);
  EXPECT_EQ(dcc::decode_rggggggg(0b1111'0010u), 113);
  EXPECT_EQ(dcc::decode_rggggggg(0b1111'0011u), 114);
  EXPECT_EQ(dcc::decode_rggggggg(0b1111'0100u), 115);
  EXPECT_EQ(dcc::decode_rggggggg(0b1111'0101u), 116);
  EXPECT_EQ(dcc::decode_rggggggg(0b1111'0110u), 117);
  EXPECT_EQ(dcc::decode_rggggggg(0b1111'0111u), 118);
  EXPECT_EQ(dcc::decode_rggggggg(0b1111'1000u), 119);
  EXPECT_EQ(dcc::decode_rggggggg(0b1111'1001u), 120);
  EXPECT_EQ(dcc::decode_rggggggg(0b1111'1010u), 121);
  EXPECT_EQ(dcc::decode_rggggggg(0b1111'1011u), 122);
  EXPECT_EQ(dcc::decode_rggggggg(0b1111'1100u), 123);
  EXPECT_EQ(dcc::decode_rggggggg(0b1111'1101u), 124);
  EXPECT_EQ(dcc::decode_rggggggg(0b1111'1110u), 125);
  EXPECT_EQ(dcc::decode_rggggggg(0b1111'1111u), 126);
}

TEST(encode_rggggggg, _128_speed_steps) {
  EXPECT_EQ(dcc::encode_rggggggg(false, -1), 0b0000'0001u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 0), 0b0000'0000u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 1), 0b0000'0010u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 2), 0b0000'0011u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 3), 0b0000'0100u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 4), 0b0000'0101u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 5), 0b0000'0110u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 6), 0b0000'0111u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 7), 0b0000'1000u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 8), 0b0000'1001u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 9), 0b0000'1010u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 10), 0b0000'1011u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 11), 0b0000'1100u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 12), 0b0000'1101u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 13), 0b0000'1110u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 14), 0b0000'1111u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 15), 0b0001'0000u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 16), 0b0001'0001u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 17), 0b0001'0010u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 18), 0b0001'0011u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 19), 0b0001'0100u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 20), 0b0001'0101u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 21), 0b0001'0110u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 22), 0b0001'0111u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 23), 0b0001'1000u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 24), 0b0001'1001u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 25), 0b0001'1010u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 26), 0b0001'1011u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 27), 0b0001'1100u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 28), 0b0001'1101u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 29), 0b0001'1110u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 30), 0b0001'1111u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 31), 0b0010'0000u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 32), 0b0010'0001u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 33), 0b0010'0010u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 34), 0b0010'0011u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 35), 0b0010'0100u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 36), 0b0010'0101u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 37), 0b0010'0110u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 38), 0b0010'0111u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 39), 0b0010'1000u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 40), 0b0010'1001u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 41), 0b0010'1010u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 42), 0b0010'1011u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 43), 0b0010'1100u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 44), 0b0010'1101u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 45), 0b0010'1110u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 46), 0b0010'1111u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 47), 0b0011'0000u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 48), 0b0011'0001u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 49), 0b0011'0010u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 50), 0b0011'0011u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 51), 0b0011'0100u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 52), 0b0011'0101u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 53), 0b0011'0110u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 54), 0b0011'0111u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 55), 0b0011'1000u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 56), 0b0011'1001u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 57), 0b0011'1010u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 58), 0b0011'1011u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 59), 0b0011'1100u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 60), 0b0011'1101u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 61), 0b0011'1110u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 62), 0b0011'1111u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 63), 0b0100'0000u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 64), 0b0100'0001u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 65), 0b0100'0010u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 66), 0b0100'0011u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 67), 0b0100'0100u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 68), 0b0100'0101u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 69), 0b0100'0110u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 70), 0b0100'0111u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 71), 0b0100'1000u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 72), 0b0100'1001u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 73), 0b0100'1010u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 74), 0b0100'1011u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 75), 0b0100'1100u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 76), 0b0100'1101u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 77), 0b0100'1110u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 78), 0b0100'1111u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 79), 0b0101'0000u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 80), 0b0101'0001u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 81), 0b0101'0010u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 82), 0b0101'0011u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 83), 0b0101'0100u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 84), 0b0101'0101u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 85), 0b0101'0110u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 86), 0b0101'0111u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 87), 0b0101'1000u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 88), 0b0101'1001u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 89), 0b0101'1010u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 90), 0b0101'1011u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 91), 0b0101'1100u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 92), 0b0101'1101u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 93), 0b0101'1110u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 94), 0b0101'1111u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 95), 0b0110'0000u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 96), 0b0110'0001u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 97), 0b0110'0010u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 98), 0b0110'0011u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 99), 0b0110'0100u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 100), 0b0110'0101u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 101), 0b0110'0110u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 102), 0b0110'0111u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 103), 0b0110'1000u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 104), 0b0110'1001u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 105), 0b0110'1010u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 106), 0b0110'1011u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 107), 0b0110'1100u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 108), 0b0110'1101u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 109), 0b0110'1110u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 110), 0b0110'1111u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 111), 0b0111'0000u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 112), 0b0111'0001u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 113), 0b0111'0010u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 114), 0b0111'0011u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 115), 0b0111'0100u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 116), 0b0111'0101u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 117), 0b0111'0110u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 118), 0b0111'0111u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 119), 0b0111'1000u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 120), 0b0111'1001u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 121), 0b0111'1010u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 122), 0b0111'1011u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 123), 0b0111'1100u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 124), 0b0111'1101u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 125), 0b0111'1110u);
  EXPECT_EQ(dcc::encode_rggggggg(false, 126), 0b0111'1111u);

  EXPECT_EQ(dcc::encode_rggggggg(true, -1), 0b1000'0001u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 0), 0b1000'0000u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 1), 0b1000'0010u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 2), 0b1000'0011u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 3), 0b1000'0100u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 4), 0b1000'0101u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 5), 0b1000'0110u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 6), 0b1000'0111u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 7), 0b1000'1000u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 8), 0b1000'1001u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 9), 0b1000'1010u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 10), 0b1000'1011u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 11), 0b1000'1100u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 12), 0b1000'1101u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 13), 0b1000'1110u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 14), 0b1000'1111u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 15), 0b1001'0000u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 16), 0b1001'0001u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 17), 0b1001'0010u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 18), 0b1001'0011u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 19), 0b1001'0100u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 20), 0b1001'0101u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 21), 0b1001'0110u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 22), 0b1001'0111u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 23), 0b1001'1000u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 24), 0b1001'1001u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 25), 0b1001'1010u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 26), 0b1001'1011u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 27), 0b1001'1100u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 28), 0b1001'1101u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 29), 0b1001'1110u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 30), 0b1001'1111u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 31), 0b1010'0000u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 32), 0b1010'0001u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 33), 0b1010'0010u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 34), 0b1010'0011u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 35), 0b1010'0100u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 36), 0b1010'0101u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 37), 0b1010'0110u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 38), 0b1010'0111u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 39), 0b1010'1000u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 40), 0b1010'1001u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 41), 0b1010'1010u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 42), 0b1010'1011u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 43), 0b1010'1100u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 44), 0b1010'1101u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 45), 0b1010'1110u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 46), 0b1010'1111u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 47), 0b1011'0000u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 48), 0b1011'0001u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 49), 0b1011'0010u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 50), 0b1011'0011u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 51), 0b1011'0100u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 52), 0b1011'0101u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 53), 0b1011'0110u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 54), 0b1011'0111u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 55), 0b1011'1000u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 56), 0b1011'1001u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 57), 0b1011'1010u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 58), 0b1011'1011u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 59), 0b1011'1100u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 60), 0b1011'1101u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 61), 0b1011'1110u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 62), 0b1011'1111u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 63), 0b1100'0000u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 64), 0b1100'0001u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 65), 0b1100'0010u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 66), 0b1100'0011u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 67), 0b1100'0100u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 68), 0b1100'0101u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 69), 0b1100'0110u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 70), 0b1100'0111u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 71), 0b1100'1000u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 72), 0b1100'1001u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 73), 0b1100'1010u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 74), 0b1100'1011u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 75), 0b1100'1100u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 76), 0b1100'1101u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 77), 0b1100'1110u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 78), 0b1100'1111u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 79), 0b1101'0000u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 80), 0b1101'0001u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 81), 0b1101'0010u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 82), 0b1101'0011u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 83), 0b1101'0100u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 84), 0b1101'0101u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 85), 0b1101'0110u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 86), 0b1101'0111u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 87), 0b1101'1000u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 88), 0b1101'1001u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 89), 0b1101'1010u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 90), 0b1101'1011u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 91), 0b1101'1100u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 92), 0b1101'1101u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 93), 0b1101'1110u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 94), 0b1101'1111u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 95), 0b1110'0000u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 96), 0b1110'0001u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 97), 0b1110'0010u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 98), 0b1110'0011u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 99), 0b1110'0100u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 100), 0b1110'0101u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 101), 0b1110'0110u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 102), 0b1110'0111u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 103), 0b1110'1000u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 104), 0b1110'1001u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 105), 0b1110'1010u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 106), 0b1110'1011u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 107), 0b1110'1100u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 108), 0b1110'1101u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 109), 0b1110'1110u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 110), 0b1110'1111u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 111), 0b1111'0000u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 112), 0b1111'0001u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 113), 0b1111'0010u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 114), 0b1111'0011u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 115), 0b1111'0100u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 116), 0b1111'0101u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 117), 0b1111'0110u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 118), 0b1111'0111u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 119), 0b1111'1000u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 120), 0b1111'1001u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 121), 0b1111'1010u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 122), 0b1111'1011u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 123), 0b1111'1100u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 124), 0b1111'1101u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 125), 0b1111'1110u);
  EXPECT_EQ(dcc::encode_rggggggg(true, 126), 0b1111'1111u);
}
